<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>جزئیات بازی</title>

  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body class="details-page">
  <div class="container">
    <h1 id="game-title">جزئیات بازی</h1>

    <div class="hero-box" style="margin-top:10px;">
      <p id="game-genre" style="margin:0 0 10px;"></p>
      <p id="game-desc" style="margin:0;"></p>
    </div>

    <img
      id="game-img"
      src=""
      alt=""
      style="width:min(700px, 100%); height:320px; object-fit:cover; border-radius:18px; display:block; margin: 0 auto 18px;"
    >

    <div class="page-actions">
      <a class="start-btn" id="back-link" href="index.html">بازگشت</a>
    </div>
  </div>

  <script src="script.js"></script>

  <script>
    // مشابه slugify خودت، اما همینجا سبک و کافی
    const norm = (s) => (s || "").toString().trim().toLowerCase().replace(/\s+/g, " ");
    const slugify = (s) => {
      return norm(s)
        .replace(/['"]/g, "")
        .replace(/[^\p{L}\p{N}\s-]/gu, "")
        .replace(/\s+/g, "-")
        .replace(/-+/g, "-")
        .replace(/^-|-$/g, "");
    };

    async function loadDetails() {
      const params = new URLSearchParams(location.search);

      // game ممکن است id باشد یا title؛ هر دو را هندل می‌کنیم
      const rawGame = (params.get("game") || "").trim();
      const gameKey = slugify(rawGame);

      const back = (params.get("back") || "").trim();

      const titleEl = document.getElementById("game-title");
      const genreEl = document.getElementById("game-genre");
      const descEl  = document.getElementById("game-desc");
      const imgEl   = document.getElementById("game-img");
      const backEl  = document.getElementById("back-link");

      // لینک بازگشت
      backEl.href = back ? back : "index.html";
      backEl.textContent = back ? "بازگشت به صفحه قبلی" : "بازگشت به خانه";

      // دیتای جزئیات
      const res = await fetch("data/games-details.json", { cache: "no-store" });
      if (!res.ok) throw new Error("Cannot load data/games-details.json");

      const list = await res.json();

      // پیدا کردن بازی: اول با id، بعد اگر کسی title فرستاده بود با slug(title)
      const item =
        list.find(x => norm(x.id) === norm(gameKey)) ||
        list.find(x => slugify(x.title) === gameKey) ||
        null;

      if (!item) {
        titleEl.textContent = "بازی پیدا نشد";
        genreEl.textContent = "";
        descEl.textContent = "اطلاعاتی برای این بازی ثبت نشده یا لینک اشتباه است.";
        imgEl.style.display = "none";
        return;
      }

      titleEl.textContent = item.title || "جزئیات بازی";
      genreEl.textContent = "ژانر: " + (item.genreFa || item.genre || "-");
      descEl.textContent  = item.desc || "";

      imgEl.src = item.image || "";
      imgEl.alt = item.title || "game";
      imgEl.style.display = item.image ? "block" : "none";
    }

    loadDetails().catch((e) => {
      console.warn(e);
      document.getElementById("game-title").textContent = "خطا";
      document.getElementById("game-desc").textContent = "فایل جزئیات لود نشد یا مسیر اشتباه است.";
      document.getElementById("game-img").style.display = "none";
    });
  </script>
</body>
</html>
